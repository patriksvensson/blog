<!DOCTYPE html>
<!--
    Phantom by HTML5 UP
    html5up.net | @ajlkn
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html lang="en">

<head>

    <title>Patrik Svensson - Debugging Rust on Windows using Visual Studio Code</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/default.min.css">
    <!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/assets/css/main.css" />
    <!--[if lte IE 9]><link rel="stylesheet" href="/assets/css/ie9.css" /><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="/assets/css/ie8.css" /><![endif]-->
    <link href="/assets/css/override.css" rel="stylesheet" />

    <meta name="description" content="This is my blog, where I write about stuff that interests me such as .NET, Rust, CI/CD and technology in general. I am a husband and a father, and I enjoy contributing to Open Source projects." />
    <link type="application/rss+xml" rel="alternate" title="Patrik Svensson" href="/feed.rss" />
    <link type="application/atom+xml" rel="alternate" title="Patrik Svensson" href="/feed.atom" />
    <!--<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">-->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">

    <meta name="application-name" content="Patrik Svensson" />
    <meta name="msapplication-tooltip" content="Patrik Svensson" />
    <meta name="msapplication-starturl" content="/" />

    <meta property="og:title" content="Patrik Svensson - Debugging Rust on Windows using Visual Studio Code" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://patriksvensson.se/2018/02/debugging-rust-on-windows-using-vscode" />
    <!-- TODO: More social graph meta tags -->

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>
</head>

<body>
    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Header -->
        <header id="header">
            <div class="inner">

                <!-- Logo -->
                <a href="/" class="logo">
                    <span class="title">Patrik Svensson</span>
                </a>

            </div>
        </header>

        <!-- Menu -->
        <nav id="menu">
            <h2>Menu</h2>
            <ul>
                <li><a href="/posts">Archive</a></li>
                <li><a href="/tags">Tags</a></li>
            </ul>
        </nav>

        <!-- Main -->
        <div id="main">
            <div class="inner">

                <header>
    <h1>Debugging Rust on Windows using Visual Studio Code</h1>
    <p><em>Published on Thursday, February 1, 2018</em>
    </p>

    <ul class="actions small">
        <li><a role="button" href="/tags/debugging" class="button small ">Debugging</a></li>
        <li><a role="button" href="/tags/lldb" class="button small ">LLDB</a></li>
        <li><a role="button" href="/tags/llvm" class="button small ">LLVM</a></li>
        <li><a role="button" href="/tags/rust" class="button small ">Rust</a></li>
    </ul>
</header>

<div id="content">
    <p>I recently wanted to debug a Rust program on Windows that I had written, and was struggling with how to get it to work. Since there was quite a lot of hoops to jump through to get it to work, I though I should share it with other people as well. I've written this blog post from memory and I'm far from an expert in LLVM or Rust, so if you see something strange here then let me know.</p>
<p>The drawback of this approach is that you can't debug applications built using the MSVC toolchain. If you know how to do this, please tell me. I would really appreciate it.</p>
<p><strong>UPDATE 2018-02-02:</strong><br />
As <a href="https://twitter.com/studoot/status/959093798692380672">Stuart Dootson pointed out to me</a>, there's a guide on how to debug applications using the MSVC toolchain <a href="http://www.brycevandyk.com/debug-rust-on-windows-with-visual-studio-code-and-the-msvc-debugger/">here</a>. I haven't tried this out myself, but it looks promising. Thanks Stuart!</p>
<h3 id="install-llvm">1. Install LLVM</h3>
<p>First we need to install LLVM which is a compiler infrastructure. Part of LLVM is LLDB which is the debugger we're going to use. The latest version of LLVM doesn't include Python support for LLDB which is required for the VSCode extension, so we need to download a custom built version and install that.</p>
<p><a href="https://github.com/vadimcn/llvm/releases">https://github.com/vadimcn/llvm/releases</a></p>
<h3 id="install-python">2. Install Python</h3>
<p>We now need to install Python v3.5 (Not v3.6).<br />
<a href="https://www.python.org/downloads/release/python-354/">https://www.python.org/downloads/release/python-354/</a></p>
<p>If you installed the x64 version of LLVM, make sure that you install the x64 version of Python as well, otherwise you will encounter problems later on.</p>
<h3 id="make-sure-it-works">3. Make sure it works</h3>
<p>Make sure that lldb can use scripting. If this doesn't work, make sure that both LLVM and Python is on PATH.</p>
<pre><code>C:&gt; lldb
(lldb) script
Python Interactive Interpreter. To exit, type 'quit()', 'exit()' or Ctrl-D.
</code></pre>
<p>Write <code>exit()</code> to close the Python interpreter and then <code>CTRL+C</code> to break out of LLDB.</p>
<h3 id="install-the-vscode-extension">4. Install the VSCode extension</h3>
<p>We now need to install the <code>vscode-lldb</code> extension for Visual Studio Code. This is what makes it possible to debug our Rust code from Visual Studio Code.<br />
<a href="https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb">https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb</a></p>
<h3 id="install-the-rust-gnu-toolchain">5. Install the Rust GNU toolchain</h3>
<p>Since LLDB doesn't work with the msvc compiler, we need to install the Rust GNU toolschain and use that one. This have some drawbacks though such as we won't be able to intop with software produced by Visual Studio.</p>
<pre><code>C:&gt; rustup install stable-gnu
</code></pre>
<h3 id="set-the-active-toolchain">6. Set the active toolchain</h3>
<p>We now need to set the Rust GNU toolchain as the active toolchain. We do this by using the <code>rustup</code> command again.</p>
<pre><code>C:&gt; rustup default stable-gnu
</code></pre>
<p>We should now verify what our toolchain configuration look like by using <code>rustup show</code>.</p>
<pre><code>C:&gt; rustup show
Default host: x86_64-pc-windows-msvc

installed toolchains
--------------------

stable-x86_64-pc-windows-gnu (default)
stable-x86_64-pc-windows-msvc
beta-x86_64-pc-windows-msvc
nightly-2017-12-08-x86_64-pc-windows-msvc
nightly-x86_64-pc-windows-msvc

active toolchain
----------------

stable-x86_64-pc-windows-gnu (default)
rustc 1.23.0 (766bd11c8 2018-01-01)
</code></pre>
<h3 id="create-a-project">7. Create a project</h3>
<p>Create a new project called <code>hello_world</code>.</p>
<pre><code>C:\Source&gt; cargo new --bin hello_world
</code></pre>
<p>Open Visual Studio Code and go to <code>./src/main.rs</code> and place a breakpoint.</p>
<h3 id="edit-launch.json">8. Edit launch.json</h3>
<p>Press F5 to run the project. A selection box will appear that will ask you what environment you want to use. Choose <code>LLDB Debugger</code> here. This will open up the <code>launch.json</code> file, and here we need to tell Visual Studio Code how to launch our project. Edit the file so it looks similar to this:</p>
<pre><code>{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [
        {
            &quot;type&quot;: &quot;lldb&quot;,
            &quot;request&quot;: &quot;launch&quot;,
            &quot;name&quot;: &quot;Debug&quot;,
            &quot;program&quot;: &quot;${workspaceRoot}/target/debug/hello_world&quot;,
            &quot;args&quot;: [],
            &quot;cwd&quot;: &quot;${workspaceRoot}/target/debug/&quot;
        }
    ]
}
</code></pre>
<h3 id="profit">9. Profit</h3>
<p>Press F5 again. You should now be debugging your code.</p>
<p><img src="/images/rust-debugging.png" alt="Debugging Rust" /></p>

</div>

            </div>
        </div>

        <!-- Footer -->
        <footer id="footer">
            <div class="inner">
                <section>
                    <h2>Feeds</h2>
                    <ul class="actions small vertical">
                        <li><a href="/rss.xml" class="button small"><i class="fa fa-rss"></i> RSS Feed</a></li>
                        <li><a href="/feed.xml" class="button small"><i class="fa fa-rss"></i> Atom Feed</a></li>
                    </ul>
                </section>
                <section>
                </section>
                <ul class="copyright">
                    <li>Copyright © 2020 Patrik Svensson</li>
                    <li>Blog forked from <a href="https://github.com/mholo65/mholo65">Martin Björkström</a></li>
                    <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
                    <li><a href="https://statiq.dev/">Generated by Statiq</a></li>
                </ul>
            </div>

        </footer>

    </div>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53005417-1', 'auto');
    ga('send', 'pageview');
</script>
    <!-- Scripts -->
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/skel.min.js"></script>
    <script src="/assets/js/util.js"></script>
    <!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
    <script src="/assets/js/main.js"></script>

</body>

</html>