
<!DOCTYPE html>
<html lang="en">
<head>

    <title>Patrik Svensson - How to create .NET Core release artifacts with GitHub Actions</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link type="application/rss+xml" rel="alternate" title="Patrik Svensson" href="/feed.rss" />
    <link type="application/atom+xml" rel="alternate" title="Patrik Svensson" href="/feed.atom" />

    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">

    <link href="/assets/styles.css" rel="stylesheet"/>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin/>

    <meta name="description" content="This is my blog, where I write about stuff that interests me such as .NET, Rust, DevOps and technology in general. I am a husband and a father, and I enjoy contributing to Open Source projects.">

        <meta name="twitter:card" content="summary_large_image"/>
        <meta name="twitter:site" content="Patrik Svensson"/>
        <meta name="twitter:title" content="How to create .NET Core release artifacts with GitHub Actions"/>
        <meta name="twitter:creator" content="This is my blog, where I write about stuff that interests me such as .NET, Rust, DevOps and technology in general. I am a husband and a father, and I enjoy contributing to Open Source projects.">
        <meta name="twitter:description" content="This is my blog, where I write about stuff that interests me such as .NET, Rust, DevOps and technology in general. I am a husband and a father, and I enjoy contributing to Open Source projects."/>
        <meta name="twitter:image" content="https://patriksvensson.se/posts/2020/03/creating-release-artifacts-with-github-actions-social.png"/>
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>

    
</head>
<body class="antialiased text-base-800 bg-base-800/10 dark:bg-base-800 transition-colors">
<header class="sticky top-0 left-2 w-full backdrop-blur bg-base-100/80 dark:bg-base-800/80 border-b border-base-900/20 dark:border-base-50/10 shadow-md dark:shadow-lg py-2 md:py-4 z-50">
    <nav class="mx-auto max-w-5xl px-4 md:px-8 xl:px-0 flex  items-center">
        <h1>
            <a class="font-extrabold text-2xl sm:text-3xl md:text-3xl base:text-3xl lg:text-4xl xl:text-4xl text-base-700 dark:text-base-300" href="/">
                Patrik Svensson
            </a>
        </h1>

        <div class="ml-auto flex items-center">
            <a class="ml-2 mr-4 text-base-400 hover:text-blue-400 transition-all hover:scale-105" title="Twitter" href="https://twitter.com/firstdrafthell">
                <svg width="1.7rem" height="1.7rem" class="fill-current" viewBox="328 355 335 276" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path  d="M 630, 425 A 195, 195 0 0 1 331, 600 A 142, 142 0 0 0 428, 570 A  70,  70 0 0 1 370, 523 A  70,  70 0 0 0 401, 521 A  70,  70 0 0 1 344, 455 A  70,  70 0 0 0 372, 460 A  70,  70 0 0 1 354, 370 A 195, 195 0 0 0 495, 442 A  67,  67 0 0 1 611, 380 A 117, 117 0 0 0 654, 363 A  65,  65 0 0 1 623, 401 A 117, 117 0 0 0 662, 390 A  65,  65 0 0 1 630, 425 Z" />
                </svg>
            </a>

            <a class="mr-4 text-base-400 hover:text-blue-400 transition-all hover:scale-105" title="LinkedIn" href="https://www.linkedin.com/in/psvensson82/">
                <svg width="1.7rem" height="1.7rem" class="fill-current" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M150.65,100.682c0,27.992-22.508,50.683-50.273,50.683c-27.765,0-50.273-22.691-50.273-50.683
                    C50.104,72.691,72.612,50,100.377,50C128.143,50,150.65,72.691,150.65,100.682z M143.294,187.333H58.277V462h85.017V187.333z
                    M279.195,187.333h-81.541V462h81.541c0,0,0-101.877,0-144.181c0-38.624,17.779-61.615,51.807-61.615
                    c31.268,0,46.289,22.071,46.289,61.615c0,39.545,0,144.181,0,144.181h84.605c0,0,0-100.344,0-173.915
                    s-41.689-109.131-99.934-109.131s-82.768,45.369-82.768,45.369V187.333z"/>
                </svg>
            </a>

            <a class="text-base-400 hover:text-blue-400 transition-all hover:scale-105" title="GitHub" href="https://github.com/patriksvensson">
                <svg width="1.7rem" height="1.7rem" class="fill-current" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"/>
                </svg>
            </a>
        </div>
    </nav>

    <nav class="mx-auto max-w-5xl px-4 md:px-8 xl:px-0 py-1 flex items-center">
        <a class="text-base-500 hover:text-blue-400 transition-all mr-4" href="/about">About</a>
        <a class="text-base-500 hover:text-blue-400 transition-all" href="https://github.com/sponsors/patriksvensson">Sponsor me</a>

        <div class="ml-auto flex items-center">
        <button aria-label="Toggle Dark Mode" class="ml-2 text-yellow-600 dark:text-base-500 stroke-1 opacity-80" style="padding-right: 2px;" onclick="swapTheme()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6"  fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
        </button>
        </div>
    </nav>
</header>

<main class="mx-auto max-w-5xl px-4 md:px-8 xl:px-0 mt-4 mb-4 md:mb-16 font-light">
    <header class="mt-6 mb-4 lg:mb-8">
            <h2 class="font-bold text-primary-700/90 dark:text-primary-500/90 text-3xl lg:font-extrabold lg:text-4xl ">How to create .NET Core release artifacts with GitHub Actions</h2>

    <div class="mt-4">
        <p class="mb-1 lg:my-b text-sm dark:text-gray-200">Posted <time>Sunday, March 22, 2020</time></p>
        
<ul class="flex space-x-1 md:space-x-2 mb-4 overflow-hidden">
<li class="text-xs md:text-sm py-1 px-2 md:py-2 md:px-4 text-primary-100 bg-primary-700/80 border border-primary-600/80 dark:text-base-100 dark:bg-primary-900/75 dark:hover:bg-base-900 dark:border-base-800 rounded md:rounded-md">
            <a href="/tags/net"> .NET</a>
        </li>
<li class="text-xs md:text-sm py-1 px-2 md:py-2 md:px-4 text-primary-100 bg-primary-700/80 border border-primary-600/80 dark:text-base-100 dark:bg-primary-900/75 dark:hover:bg-base-900 dark:border-base-800 rounded md:rounded-md">
            <a href="/tags/github"> GitHub</a>
        </li>
<li class="text-xs md:text-sm py-1 px-2 md:py-2 md:px-4 text-primary-100 bg-primary-700/80 border border-primary-600/80 dark:text-base-100 dark:bg-primary-900/75 dark:hover:bg-base-900 dark:border-base-800 rounded md:rounded-md">
            <a href="/tags/github-actions"> GitHub Actions</a>
        </li>
</ul>
    
    </div>
    </header>
    
    


<article class="prose dark:prose-invert mt-8 lg:prose-lg max-w-full font-light lg:leading-loose">
    <p>In this blog post, we'll create a <a href="https://github.com/features/actions">GitHub Action</a> that triggers each time a release is published, builds a binary on three different build agents (Windows, macOS, and Ubuntu), and attaches the compressed artifacts to the release.</p>
<!--excerpt-->
<p>There's a myriad of ways of doing this, but this has so far worked out great for me.</p>
<p><img src="gh_assets.png" alt="A GitHub release with artifacts" /></p>
<p>For this blog post, I've created a .NET Core 3.1 console application whose only purpose is to write &quot;Hello World&quot; to the console. It's this application we build and package when we create a new GitHub release, and the source code can be found at <a href="https://github.com/patriksvensson/dotnet-release-artifacts/tree/master/src">https://github.com/patriksvensson/dotnet-release-artifacts/tree/master/src</a></p>
<h2 id="create-the-github-action">1. Create the GitHub Action</h2>
<p>We start by creating a new <a href="https://help.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow#creating-a-workflow-file">workflow file</a> under <code>.github/workflows</code> in the repository. We call this <code>ci.yaml</code>, but you can name this anything you want as long as it's a YAML file. We then proceed to tell GitHub that we want this workflow to run every time we publish a new release.</p>
<pre><code class="language-yaml">name: Publish
on:
  release:
    types: [published]
</code></pre>
<h2 id="define-the-build-strategy">2. Define the build strategy</h2>
<p>Now we want to add a job, which we'll call <code>Release</code>, and define a build strategy. We'll use a <a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstrategy">matrix</a> with all the information we need for our different builds, such as what build agent we want to use for each element in the matrix, and what runtime to target.</p>
<pre><code class="language-yaml">jobs:
  release:
    name: Release
    strategy:
      matrix:
        kind: ['linux', 'windows', 'macOS']
        include:
          - kind: linux
            os: ubuntu-latest
            target: linux-x64
          - kind: windows
            os: windows-latest
            target: win-x64
          - kind: macOS
            os: macos-latest
            target: osx-x64
    runs-on: ${{ matrix.os }}
</code></pre>
<p>Notice that we reference the <code>os</code> matrix metadata in the <code>runs-on</code> node via <code>{{ matrix.os }}</code>. You can reference any data defined in the matrix this way.</p>
<p>As you can see in the image below, the name of each step in the matrix will be a combination of the job name and the name of the matrix element.</p>
<p><img src="gh_job.png" alt="A GitHub Actions job" /></p>
<h2 id="build-package-and-publish">3. Build, package and publish</h2>
<p>Now when we've defined the workflow and the build matrix, we'll have to do four things.</p>
<ol>
<li>Check out the code</li>
<li>Setup .NET Core and define what SDK we're going to use</li>
<li>Build our project and create the release artifacts</li>
<li>Publish the release artifacts</li>
</ol>
<p>Let's start with the first two since there are already pre-made actions for these.</p>
<pre><code class="language-yaml">    steps:
      - name: Checkout
        uses: actions/checkout&#64;v1

      - name: Setup dotnet
        uses: actions/setup-dotnet&#64;v1
        with:
          dotnet-version: 3.1.101
</code></pre>
<p>Now when everything is in place, we need to build our artifacts and publish them. Since we want to be idiomatic on all platforms, we zip the artifacts on Windows and package them as <code>tar.gz</code> on Linux and macOS.</p>
<pre><code class="language-yaml">      - name: Build
        shell: bash
        run: |
          # Define some variables for things we need
          tag=$(git describe --tags --abbrev=0)
          release_name=&quot;App-$tag-${{ matrix.target }}&quot;

          # Build everything
          dotnet publish src/App/App.csproj --framework netcoreapp3.1 --runtime &quot;${{ matrix.target }}&quot; -c Release -o &quot;$release_name&quot;

          # Pack files
          if [ &quot;${{ matrix.target }}&quot; == &quot;win-x64&quot; ]; then
            7z a -tzip &quot;${release_name}.zip&quot; &quot;./${release_name}/*&quot;
          else
            tar czvf &quot;${release_name}.tar.gz&quot; &quot;$release_name&quot;
          fi

          # Delete output directory
          rm -r &quot;$release_name&quot;
</code></pre>
<p>You might have noticed that we run the build step in a Bash shell and wonder how that works on Windows (at least I did). The answer is that it runs under Git Bash and not under Windows Subsystem for Linux (WSL), as one might have thought.</p>
<p>Finally, once we've built and packaged everything up, we'll add the artifacts to our release. For this, we'll use <a href="https://github.com/softprops/action-gh-release">softprops/action-gh-release</a> GitHub Action, which I think works very well.</p>
<pre><code class="language-yaml">      - name: Publish
        uses: softprops/action-gh-release&#64;v1
        with:
          files: &quot;App*&quot;
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
</code></pre>
<p>That's all there is to it. If you want to create a release, all you have to do is create a new tag, go to the GitHub release page, and create a release from the newly created tag.</p>
<pre><code class="language-shell">&gt; git tag 1.0
&gt; git push --tags
</code></pre>
<p>You can find the complete YAML file <a href="https://github.com/patriksvensson/dotnet-release-artifacts/blob/master/.github/workflows/ci.yaml">here</a>.</p>
<h2 id="wrapping-up">Wrapping up</h2>
<p>As I've previously mentioned, there is a myriad of different ways of doing this. What I have described in this blog post is only one of them, but I've found that it has served me well and is reasonably easy to understand even if you're new to GitHub Actions.</p>

</article>

    <div class="flex mt-8 md:mt-12 mb-8 p-4 border border-primary-400/50  bg-primary-200/50 dark:border-primary-800 dark:bg-primary-700/50 shadow-md rounded-md items-center">
        <svg class="fill-current text-primary-900/75 dark:text-primary-300/75" width="2rem" height="2rem" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 1024 1024" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"/>
        </svg>
        <p class="ml-4 text-base-700 dark:text-primary-300 text-xs md:text-sm">View the supporting repository at <a class="font-normal break-all" href="https://github.com/patriksvensson/dotnet-release-artifacts">https://github.com/patriksvensson/dotnet-release-artifacts</a></p>
    </div>

</main>

<footer>
    <span class="mx-auto  text-base-800 dark:text-base-200 py-4 max-w-4xl block text-sm font-light text-center">
        &copy; Patrik Svensson<br />
        Blog design by <a class="text-blue-700 dark:text-blue-300" href="https://github.com/phil-scott-78/thirty25-statiq">Phil Scott</a> 
        | Built with <a class="text-blue-700 dark:text-blue-300" href="https://statiq.dev/">Statiq</a>
    </span>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/prism.min.js" integrity="sha512-pSVqGtpGygQlhN8ZTHXx1kqkjQr30eM+S6OoSzhHGTjh6DKdfy7WZlo1DNO9bhtM0Imf6xNLznZ7iVC2YUMwJQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-GP4x8UWxWyh4BMbyJGOGneiTbkrWEF5izsVJByzVLodP8CuJH/n936+yQDMJJrOPUHLgyPbLiGw2rXmdvGdXHA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
            function swapTheme(){
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.theme = 'light';
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.theme = 'dark';
                }                
            }
        </script>
</body>
</html>